<!DOCTYPE html>
<html lang="az" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Professional Task Management System">
    <title>Task Manager Pro | İş İdarəetmə Paneli</title>

    <link rel="stylesheet" href="../assets/css/task_css/task.css" />
    <link rel="stylesheet" href="../assets/css/task_css/edit_module.css" />
    <link rel="stylesheet" href="../assets/css/task_css/buttonManager.css" />
    <link rel="stylesheet" href="../assets/css/task_css/modals.css" />
    <link rel="stylesheet" href="../assets/css/task_css/main.css" />
    <link rel="stylesheet" href="../assets/css/task_css/task_details_modal.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ... Digər stil kodlarınız (Modallar və s.) qala bilər ... */

        /* 1. HEADER - Artıq həmişə görünür */
        header {
            display: block !important; /* Həmişə görünməsi üçün */
            background: #fff;
            z-index: 100; /* Menyunun üstündə qalması üçün */
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            margin-bottom: 0 !important;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        /* 2. MENYU KONTEYNERİ - İlkin hal (Header-in altında) */
        .task-menu-container {
            position: fixed;
            /* Header təxminən 90-100px yer tutur, ona görə top-u dəyişirik */
            top: 100px;
            left: 0;
            width: 100%;
            /* Hündürlüyü header-i çıxmaq şərtilə hesablayırıq */
            height: calc(100vh - 100px);
            background: #f8f9fa;
            z-index: 90;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* 3. NAVBAR REJİMİ (Seçim ediləndə yuxarı yapışır) */
        .task-menu-container.nav-mode {
            position: relative; /* Fixed-dən çıxır */
            top: 0; /* Normal axına qayıdır */
            height: auto;
            min-height: 80px;
            background: #ffffff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            padding: 10px 20px;
            align-items: center;
            justify-content: center;
            gap: 15px;
            z-index: 50;
        }

        /* Kartların dizaynı (Olduğu kimi qalır) */
        .menu-card {
            background: white;
            width: 300px;
            height: 200px;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.4s ease;
            border: 1px solid rgba(0,0,0,0.02);
            position: relative;
            overflow: hidden;
        }

        /* ... Rənglər və digər köhnə CSS-ləriniz olduğu kimi qalır ... */

        /* Yalnız bu hissəyə diqqət edin (Məzmun) */
        .page-content {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            display: none;
            padding-top: 20px;
        }

        .page-content.content-visible {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        /* ... Digər animasiya və kart stilləriniz ... */

        /* Rəng kodları köhnə faylınızdan gəlir, bura əlavə etmirəm yer tutmasın */
        .menu-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(64, 129, 255, 0.15); }
        .menu-card i { font-size: 3rem; margin-bottom: 15px; transition: all 0.4s ease; }
        .menu-card span { font-size: 1.2rem; font-weight: 600; color: #1f2a44; transition: all 0.4s ease; }

        .menu-card.card-active i { color: #3b82f6; }
        .menu-card.card-external i { color: #8b5cf6; }
        .menu-card.card-archive i { color: #64748b; }
        .menu-card.card-partner i { color: #f59e0b; }

        .menu-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: #ccc; }
        .menu-card.card-active::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .menu-card.card-external::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
        .menu-card.card-archive::before { background: linear-gradient(90deg, #64748b, #94a3b8); }
        .menu-card.card-partner::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }

        /* Navbar Rejimində Kartların Görünüşü (Olduğu kimi) */
        .task-menu-container.nav-mode .menu-card {
            width: auto;
            height: 50px;
            flex-direction: row;
            padding: 0 25px;
            border-radius: 12px;
            background: #f1f5f9;
            box-shadow: none;
            gap: 10px;
            margin: 0;
            border: 1px solid transparent;
        }
        .task-menu-container.nav-mode .menu-card:hover { transform: translateY(-2px); background: #e2e8f0; }
        .task-menu-container.nav-mode .menu-card.active-tab { background: white; border-color: #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15); }
        .task-menu-container.nav-mode .menu-card.active-tab.card-external { border-color: #8b5cf6; }
        .task-menu-container.nav-mode .menu-card.active-tab.card-archive { border-color: #64748b; }
        .task-menu-container.nav-mode .menu-card.active-tab.card-partner { border-color: #f59e0b; }

        .task-menu-container.nav-mode .menu-card i { font-size: 1.2rem; margin-bottom: 0; }
        .task-menu-container.nav-mode .menu-card span { font-size: 0.95rem; }
        .task-menu-container.nav-mode .menu-card::before { display: none; }

        .task-section { display: none; animation: fadeIn 0.4s ease-in-out; }
        .task-section.active-section { display: block; }
    </style>
</head>
<body>
<div class="theme-toggle">
    <button id="themeToggle" class="secondary-btn btn-icon" title="Tema dəyiş">
        <i class="fas fa-moon"></i>
    </button>
</div>

<header id="mainHeader">
    <div class="header-actions header-actions--split">
        <div class="header-nav-buttons">
            <button class="secondary-btn nav-btn btn-icon" id="refreshBtn">
                <i class="fas fa-sync-alt"></i> <span>Yenilə</span>
            </button>
        </div>

        <div class="header-task-buttons">
            <button class="secondary-btn btn-icon" id="openFilterBtn">
                <i class="fas fa-filter"></i> <span>Filtr</span>
                <span class="filter-badge" id="filterBadge">0</span>
            </button>
            <button class="primary-btn btn-icon" id="openModalBtn">
                <i class="fas fa-plus"></i> <span>Yeni iş</span>
            </button>
            <button class="secondary-btn btn-icon" id="exportBtn">
                <i class="fas fa-file-export"></i>
            </button>
            <button class="header-logout-btn" onclick="logoutUser()" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </div>
</header>

<div class="task-menu-container" id="mainTaskMenu">
    <div class="menu-card card-active" onclick="switchTaskView('active', this)">
        <i class="fas fa-tasks"></i>
        <span>Şirkətin Aktiv İşləri</span>
    </div>

    <div class="menu-card card-external" onclick="switchTaskView('external', this)">
        <i class="fas fa-building"></i>
        <span>Digər Şirkətlər</span>
    </div>

    <div class="menu-card card-partner" onclick="switchTaskView('partner', this)">
        <i class="fas fa-handshake"></i>
        <span>Partnyorlar</span>
    </div>
    <div class="menu-card card-archive" onclick="switchTaskView('archive', this)">
        <i class="fas fa-archive"></i>
        <span>Arxiv İşlər</span>
    </div>

</div>



<main class="page-content" id="mainContentArea">

    <section id="section-active" class="table-card task-section active-section">
        <div class="table-header">
            <div class="table-meta">
                <div class="table-actions">
                    <button class="table-action-btn" id="activeSortBtn"><i class="fas fa-sort-amount-down"></i></button>
                    <button class="table-action-btn" id="activeColumnsBtn"><i class="fas fa-columns"></i></button>
                    <button class="table-action-btn" id="prevBtnList"><i class="fas fa-chevron-left"></i></button>
                    <button class="table-action-btn" id="nextBtnList"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="table-title-group">
                    <h2 class="table-title"><i class="fas fa-tasks table-icon"></i> Şirkətin Aktiv İşləri</h2>
                    <div class="table-subtitle" id="tableMeta">Yüklənir...</div>
                </div>
            </div>
        </div>
        <div class="table-wrapper">
            <table class="excel-table data-table">
                <thead>
                <tr>
                    <th class="text-center" data-min-width="50"><div class="table-header-cell"><span>S/S</span></div></th>
                    <th data-min-width="120"><div class="table-header-cell"><span>Tarix</span></div></th>
                    <th data-min-width="150"><div class="table-header-cell"><span>Şirkət</span></div></th>
                    <th data-min-width="190"><div class="table-header-cell"><span>Kim tərəfindən</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>İcra edən</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>Əməliyyatlar</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>İşin növü</span></div></th>
                    <th data-min-width="150"><div class="table-header-cell"><span>Tapşırıq açıqlaması</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>Fayl</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>Son müddət</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>Status</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>İcra tarixi</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>İcra müddəti</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>Saatlıq əmək haqqı</span></div></th>
                    <th data-min-width="180"><div class="table-header-cell"><span>Formalaşan əmək haqqı</span></div></th>
                    <th data-min-width="150"><div class="table-header-cell"><span>Şöbə</span></div></th>
                </tr>
                </thead>
                <tbody id="tableBody">
                <tr class="loading-row">
                    <td colspan="16">
                        <div class="table-loading">
                            <div class="loader"><div></div><div></div></div>
                            <p>Məlumatlar yüklənir...</p>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <section id="section-external" class="table-card task-section">
        <div class="table-header">
            <div class="table-meta">
                <div class="table-actions">
                    <button class="table-action-btn" id="externalSortBtn"><i class="fas fa-sort-amount-down"></i></button>
                    <button class="table-action-btn" id="externalColumnsBtn"><i class="fas fa-columns"></i></button>
                    <button class="table-action-btn" id="externalPrevBtn"><i class="fas fa-chevron-left"></i></button>
                    <button class="table-action-btn" id="externalNextBtn"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="table-title-group">
                    <h2 class="table-title"><i class="fas fa-building table-icon"></i> Digər Şirkətlərin İşləri</h2>
                    <div class="table-subtitle" id="externalMeta">Digər şirkətlərdən gələn iş sorğuları</div>
                </div>
            </div>
        </div>
        <div class="table-wrapper">
            <table class="excel-table data-table">
                <thead>
                <tr>
                    <th class="text-center" data-min-width="50"><div class="table-header-cell"><span>S/S</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Tarix</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Şirkət</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Kim tərəfindən</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>İcra edən</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Əməliyyatlar</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>İşin növü</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Tapşırıq açıqlaması</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Fayl</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Son müddət</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>Status</span></div></th>
                    <th data-min-width="80"><div class="table-header-cell"><span>İcra tarixi</span></div></th>
                </tr>
                </thead>
                <tbody id="externalTableBody">
                <tr class="empty-row">
                    <td colspan="12">
                        <div class="empty-state">
                            <i class="fas fa-building fa-2x"></i>
                            <h3>Digər Şirkət İşləri</h3>
                            <p>Hazırda heç bir iş sorğusu yoxdur.</p>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <section id="section-archive" class="table-card task-section">
        <div class="table-header">
            <div class="table-meta">
                <div class="table-actions">
                    <button class="table-action-btn" id="archiveSortBtn"><i class="fas fa-sort-amount-down"></i></button>
                    <button class="table-action-btn" id="archivePrevBtn"><i class="fas fa-chevron-left"></i></button>
                    <button class="table-action-btn" id="archiveNextBtn"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="table-title-group">
                    <h2 class="table-title"><i class="fas fa-archive table-icon"></i> Arxiv</h2>
                    <div class="table-subtitle" id="archiveMeta">Tamamlanmış işlər</div>
                </div>
                <div class="table-actions">
                    <button class="secondary-btn btn-sm" id="exportArchiveBtn">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
        </div>
        <div class="table-wrapper">
            <table class="excel-table data-table">
                <thead>
                <tr>
                    <th class="text-center">S/S</th>
                    <th>Tarix</th>
                    <th>Şirkət</th>
                    <th>Kim tərəfindən</th>
                    <th>İcra edən</th>
                    <th>Şöbə</th>
                    <th>İşin növü</th>
                    <th class="description-col">Tapşırıq açıqlaması</th>
                    <th class="file-col">Fayl</th>
                    <th>Son müddət</th>
                    <th>Status</th>
                    <th>İcra tarixi</th>
                    <th>İcra müddəti</th>
                    <th>Saatlıq əmək haqqı</th>
                    <th>Formalaşan əmək haqqı</th>
                </tr>
                </thead>
                <tbody id="archiveTableBody">
                <tr class="empty-row">
                    <td colspan="15">
                        <div class="empty-state">
                            <i class="fas fa-archive fa-2x"></i>
                            <h3>Arxivlənmiş İşlər</h3>
                            <p>Məlumat yüklənməyib.</p>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="table-footer">
            <div class="table-summary"><span id="archiveSummary">0 arxiv qeydi</span></div>
            <div class="archive-actions">
                <button class="secondary-btn btn-icon" id="archiveLoadMoreBtn" type="button">
                    <span>Daha çox yüklə</span>
                </button>
            </div>
        </div>
    </section>
    <section id="section-partner" class="table-card task-section">
        <div class="table-header">
            <div class="table-meta">
                <div class="table-actions">
                    <button class="table-action-btn" id="partnerSortBtn"><i class="fas fa-sort-amount-down"></i></button>
                    <button class="table-action-btn" id="partnerPrevBtn"><i class="fas fa-chevron-left"></i></button>
                    <button class="table-action-btn" id="partnerNextBtn"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="table-title-group">
                    <h2 class="table-title">
                        <i class="fas fa-handshake table-icon text-amber-500"></i>
                        Partnyorlar
                    </h2>
                    <div class="table-subtitle" id="partnerMeta">Yüklənir...</div>
                </div>
            </div>
        </div>
        <div class="table-wrapper">
            <table class="excel-table data-table">
                <thead>
                <tr>
                    <th class="text-center" style="width: 50px;">S/S</th>

                    <th style="min-width: 120px;">Tarix</th>

                    <th style="min-width: 150px;">Şirkət</th>

                    <th style="min-width: 150px;">Kim tərəfindən</th>

                    <th style="min-width: 150px;">Yönəldən Şirkət</th>

                    <th style="min-width: 150px;">İcra edən şirkət</th>

                    <th style="min-width: 100px;">Əməliyyat</th>

                    <th style="min-width: 120px;">Son müddət</th>

                    <th style="min-width: 100px;">Status</th>

                    <th style="min-width: 150px;">Məsul Şəxs</th>

                    <th style="min-width: 140px;">M.Ş Əlaqə</th>
                </tr>
                </thead>
                <tbody id="partnerTableBody">
                </tbody>
            </table>
        </div>
    </section>
</main>

<footer class="page-footer">
    <div class="footer-content">
        <div class="footer-info">
            <span class="footer-brand">Task Manager Pro © 2024</span>
            <span class="footer-status" id="connectionStatus"><i class="fas fa-circle online"></i> Onlayn</span>
        </div>
    </div>
</footer>

<div class="modal-backdrop" id="taskModal">
    <div class="modal modal-lg" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-header">
            <div class="modal-title-group">
                <div class="modal-title" id="modalTitle">
                    <i class="fas fa-plus-circle"></i>
                    <span>Yeni İş Əlavə Et</span>
                </div>
                <div class="modal-subtitle">Yeni iş tapşırığı yaratmaq üçün bütün məlumatları doldurun</div>
            </div>
            <button class="close-btn" id="closeModalBtn" aria-label="Bağla">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="taskForm" class="modal-form">
            <div class="form-tabs">
                <div class="form-tab active" data-tab="basic">
                    <span>Əsas Məlumatlar</span>
                </div>
                <div class="form-tab" data-tab="details">
                    <span>Detallar</span>
                </div>
            </div>

            <div class="form-content">
                <div class="form-tab-content active" id="basicTab">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="companySelect" class="form-label">
                                <i class="fas fa-building"></i>
                                Şirkət
                            </label>
                            <div class="select-wrapper">
                                <select id="companySelect" name="company_id" required class="form-select">
                                    <option value="">Şirkət seçin</option>
                                </select>
                                <i class="fas fa-chevron-down select-icon"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="dueAtInput" class="form-label">
                                <i class="fas fa-calendar-times"></i>
                                Son Müddət
                            </label>
                            <input
                                    id="dueAtInput"
                                    name="due_date"
                                    type="date"
                                    required
                                    class="form-input"
                            />
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="isVisibleToOtherCompanies" name="is_visible_to_other_companies" class="checkbox-input">
                                <label for="isVisibleToOtherCompanies" class="checkbox-label">
                                    <i class="fas fa-eye"></i>
                                    Seçilmiş şirkətə göstər
                                </label>
                                <div class="form-hint">
                                    Bu task-ı seçdiyiniz şirkətin "Digər şirkətlər" siyahısında göstər
                                    <br>
                                    <small>Yalnız alt şirkətlər üçün işləyir</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="executorSelect" class="form-label">
                                <i class="fas fa-user-tie"></i>
                                İcra Edən
                            </label>
                            <div class="select-wrapper">
                                <select id="executorSelect" name="executor_user_id" required class="form-select">
                                    <option value="">İşçi seçin</option>
                                </select>
                                <i class="fas fa-chevron-down select-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="departmentSelect" class="form-label">
                                <i class="fas fa-sitemap"></i>
                                Şöbə
                            </label>
                            <div class="select-wrapper">
                                <select id="departmentSelect" name="department_id" required class="form-select">
                                    <option value="">Şöbə seçin</option>
                                </select>
                                <i class="fas fa-chevron-down select-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="taskTypeSelect" class="form-label">
                                <i class="fas fa-tasks"></i>
                                İşin Növü
                            </label>
                            <div class="select-wrapper">
                                <select id="taskTypeSelect" name="task_type_id" required class="form-select">
                                    <option value="">İş növü seçin</option>
                                </select>
                                <i class="fas fa-chevron-down select-icon"></i>
                            </div>
                        </div>

                        <div class="form-group" style="grid-column: span 2;">
                            <label for="descriptionInput" class="form-label">
                                <i class="fas fa-align-left"></i>
                                Tapşırıq Açıqlaması
                            </label>
                            <textarea
                                    id="descriptionInput"
                                    name="description"
                                    placeholder="Tapşırığın detallı təsvirini yazın..."
                                    rows="4"
                                    class="form-textarea"
                            ></textarea>
                            <div class="form-hint">Tapşırığı dəqiq təsvir edin</div>
                        </div>
                    </div>
                </div>

                <div class="form-tab-content" id="detailsTab">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="taskAttachment" class="form-label">
                                <i class="fas fa-paperclip"></i>
                                Fayl Əlavəsi
                            </label>
                            <div class="file-upload-zone" id="fileDropZone">
                                <div class="file-upload-icon">
                                    <i class="fas fa-cloud-upload-alt fa-2x"></i>
                                </div>
                                <div class="file-upload-text">
                                    Faylı buraya sürüşdürün və ya klikləyin
                                </div>
                                <div class="file-upload-hint">
                                    Dəstəklənən formatlar: PDF, Excel, Word, Şəkil, Video, Audio
                                </div>
                                <input
                                        type="file"
                                        id="taskAttachment"
                                        name="attachment"
                                        accept=".xlsx,.xls,.pdf,.jpg,.png,.jpeg,.doc,.docx,.mp4,.avi,.mov,.mp3,.wav,.ogg,.zip,.rar"
                                        class="file-input"
                                        hidden
                                        multiple
                                />
                            </div>
                            <div class="file-list" id="fileList"></div>
                            <div id="fileUploadStatus" style="display: none;">
                                <div class="upload-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="uploadProgress"></div>
                                    </div>
                                    <span class="upload-text">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Fayl yüklənir...
                                        </span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="grid-column: span 2;">
                            <label class="form-label">
                                <i class="fas fa-microphone"></i>
                                Səs Qeydi Əlavə Et
                            </label>
                            <div class="audio-recorder-container">
                                <div class="audio-recorder-controls">
                                    <button type="button" class="btn btn-outline-primary" id="startRecordingBtn">
                                        <i class="fas fa-microphone"></i>
                                        Səs Qeydinə Başla
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" id="stopRecordingBtn" disabled>
                                        <i class="fas fa-stop"></i>
                                        Dayandır
                                    </button>
                                    <button type="button" class="btn btn-outline-success" id="saveRecordingBtn" disabled>
                                        <i class="fas fa-save"></i>
                                        Saxla
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="cancelRecordingBtn" disabled>
                                        <i class="fas fa-times"></i>
                                        Ləğv et
                                    </button>
                                </div>

                                <div class="audio-recorder-status">
                                    <div id="recordingStatus" class="recording-status">
                                        <i class="fas fa-circle text-muted"></i>
                                        <span>Səs qeydi hazırdır</span>
                                    </div>
                                    <div id="recordingTimer" class="recording-timer" style="display: none;">
                                        <i class="fas fa-clock"></i>
                                        <span id="timerDisplay">00:00</span>
                                    </div>
                                </div>

                                <div class="audio-recorder-visualizer">
                                    <canvas id="audioVisualizer" width="400" height="60"></canvas>
                                </div>

                                <div class="audio-recorder-preview" id="audioPreview" style="display: none;">
                                    <div class="audio-player">
                                        <audio id="recordedAudio" controls></audio>
                                        <div class="audio-info">
                                            <span id="audioDuration">Müddət: 0:00</span>
                                            <span id="audioSize">Ölçü: 0 KB</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-hint">
                                Maksimum qeyd müddəti: 5 dəqiqə. Səs qeydi .wav formatında saxlanılacaq.
                            </div>

                            <input type="hidden" id="audioData" name="audio_data">
                            <input type="hidden" id="audioFilename" name="audio_filename">
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <div class="form-navigation">
                    <button type="button" class="secondary-btn btn-icon" id="prevTabBtn">
                        <i class="fas fa-arrow-left"></i>
                        <span>Əvvəlki</span>
                    </button>
                    <div class="form-steps">
                        <span class="step active" data-step="1"></span>
                        <span class="step" data-step="2"></span>
                    </div>
                    <button type="button" class="secondary-btn btn-icon" id="nextTabBtn">
                        <span>Növbəti</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div class="form-actions">
                    <button type="button" class="secondary-btn" id="cancelBtn">
                        <i class="fas fa-times"></i>
                        Ləğv et
                    </button>
                    <button type="submit" class="primary-btn" id="saveBtn">
                        <i class="fas fa-save"></i>
                        Yadda Saxla
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="modal-backdrop" id="filterModal">
    <div class="modal filter-modal" role="dialog" aria-modal="true" aria-labelledby="filterModalTitle">
        <div class="modal-header">
            <div class="modal-title" id="filterModalTitle">
                <i class="fas fa-filter"></i>
                Filtrləmə Seçimləri
            </div>
            <button class="close-btn" id="closeFilterBtn" aria-label="Bağla">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="filterForm" class="modal-form">
            <div class="form-content">

                <div class="form-group" style="grid-column: span 2; margin-bottom: 20px;">
                    <label class="form-label">
                        <i class="fas fa-table"></i>
                        Filtrlənəcək Cədvəl
                    </label>
                    <div class="table-selection-radios">
                        <div class="radio-group">
                            <input type="radio" id="filterActiveTable" name="filter_table" value="active" class="radio-input" checked>
                            <label for="filterActiveTable" class="radio-label">
                                    <span class="radio-icon">
                                        <i class="fas fa-tasks"></i>
                                    </span>
                                <span class="radio-text">
                                        <strong>Şirkətin Aktiv İşləri</strong>
                                        <small>Yalnız aktiv və gözləyən task-lar</small>
                                    </span>
                            </label>
                        </div>

                        <div class="radio-group">
                            <input type="radio" id="filterExternalTable" name="filter_table" value="external" class="radio-input">
                            <label for="filterExternalTable" class="radio-label">
                                    <span class="radio-icon">
                                        <i class="fas fa-building"></i>
                                    </span>
                                <span class="radio-text">
                                        <strong>Digər Şirkətlərin İşləri</strong>
                                        <small>Xarici şirkətlərdən gələn task-lar</small>
                                    </span>
                            </label>
                        </div>

                        <div class="radio-group">
                            <input type="radio" id="filterArchiveTable" name="filter_table" value="archive" class="radio-input">
                            <label for="filterArchiveTable" class="radio-label">
                                    <span class="radio-icon">
                                        <i class="fas fa-archive"></i>
                                    </span>
                                <span class="radio-text">
                                        <strong>Arxiv İşlər</strong>
                                        <small>Tamamlanmış və arxivlənmiş task-lar</small>
                                    </span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="grid-column: span 2;">
                    <label class="form-label">
                        <i class="fas fa-calendar-plus"></i>
                        Yaranma Tarixi Aralığı
                    </label>
                    <div class="inline-fields">
                        <div class="date-field">
                            <label for="filterCreatedFrom" class="field-label">Başlanğıc</label>
                            <input
                                    id="filterCreatedFrom"
                                    name="created_from"
                                    type="datetime-local"
                                    class="form-input"
                            />
                        </div>
                        <div class="date-field">
                            <label for="filterCreatedTo" class="field-label">Son</label>
                            <input
                                    id="filterCreatedTo"
                                    name="created_to"
                                    type="datetime-local"
                                    class="form-input"
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group" style="grid-column: span 2;">
                    <label class="form-label">
                        <i class="fas fa-calendar-times"></i>
                        Son Müddət Aralığı
                    </label>
                    <div class="inline-fields">
                        <div class="date-field">
                            <label for="filterDueFrom" class="field-label">Başlanğıc</label>
                            <input
                                    id="filterDueFrom"
                                    name="due_from"
                                    type="datetime-local"
                                    class="form-input"
                            />
                        </div>
                        <div class="date-field">
                            <label for="filterDueTo" class="field-label">Son</label>
                            <input
                                    id="filterDueTo"
                                    name="due_to"
                                    type="datetime-local"
                                    class="form-input"
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="filterCompanySelect" class="form-label">
                        <i class="fas fa-building"></i>
                        Şirkət
                    </label>
                    <div class="select-wrapper">
                        <select id="filterCompanySelect" name="company_id" class="form-select">
                            <option value="">Hamısı</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="filterExecutorSelect" class="form-label">
                        <i class="fas fa-user-tie"></i>
                        İcra Edən
                    </label>
                    <div class="select-wrapper">
                        <select id="filterExecutorSelect" name="executor_user_id" class="form-select">
                            <option value="">Hamısı</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="filterDepartmentSelect" class="form-label">
                        <i class="fas fa-sitemap"></i>
                        Şöbə
                    </label>
                    <div class="select-wrapper">
                        <select id="filterDepartmentSelect" name="department_id" class="form-select">
                            <option value="">Hamısı</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="filterTaskTypeSelect" class="form-label">
                        <i class="fas fa-tasks"></i>
                        İşin Növü
                    </label>
                    <div class="select-wrapper">
                        <select id="filterTaskTypeSelect" name="task_type_id" class="form-select">
                            <option value="">Hamısı</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label for="filterStatusSelect" class="form-label">
                        <i class="fas fa-flag"></i>
                        Status
                    </label>
                    <div class="select-wrapper">
                        <select id="filterStatusSelect" name="status" class="form-select">
                            <option value="">Hamısı</option>
                            <option value="pending">Gözləmədə</option>
                            <option value="in_progress">İcra olunur</option>
                            <option value="completed">Tamamlanmış</option>
                            <option value="cancelled">Ləğv edilmiş</option>
                            <option value="overdue">Vaxtı keçmiş</option>
                        </select>
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="secondary-btn" id="resetFiltersBtn">
                    <i class="fas fa-redo"></i>
                    Sıfırla
                </button>
                <button type="submit" class="primary-btn">
                    <i class="fas fa-check"></i>
                    Filtrlə
                </button>
            </div>
        </form>
    </div>
</div>

<div class="modal-backdrop" id="descriptionModal">
    <div class="modal description-modal" role="dialog" aria-modal="true" aria-labelledby="descriptionModalTitle">
        <div class="modal-header">
            <div class="modal-title" id="descriptionModalTitle">
                <i class="fas fa-info-circle"></i>
                Tapşırıq Detalları
            </div>
            <button class="close-btn" id="closeDescriptionBtn" aria-label="Bağla">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-content">
            <div class="task-detail-grid">
                <div class="task-detail-section">
                    <div class="detail-label">Tapşırıq Kodu</div>
                    <div class="detail-value" id="detailTaskCode">-</div>
                </div>

                <div class="task-detail-section">
                    <div class="detail-label">Status</div>
                    <div class="detail-value">
                        <span class="status-badge status-pending" id="detailStatus">Gözləmədə</span>
                    </div>
                </div>

                <div class="task-detail-section full-width">
                    <div class="detail-label">Açıqlama</div>
                    <div class="detail-text multiline" id="detailDescription">
                        Açıqlama yoxdur
                    </div>
                </div>

                <div class="task-detail-section full-width">
                    <div class="detail-label">Qeydlər</div>
                    <div class="detail-text multiline" id="detailNotes">
                        Qeyd yoxdur
                    </div>
                </div>

                <div class="task-detail-section">
                    <div class="detail-label">Yaradılma Tarixi</div>
                    <div class="detail-value" id="detailCreatedAt">-</div>
                </div>

                <div class="task-detail-section">
                    <div class="detail-label">Son Müddət</div>
                    <div class="detail-value" id="detailDueAt">-</div>
                </div>

                <div class="task-detail-section">
                    <div class="detail-label">Tamamlanma Tarixi</div>
                    <div class="detail-value" id="detailCompletedAt">-</div>
                </div>

                <div class="task-detail-section">
                    <div class="detail-label">İcra Müddəti</div>
                    <div class="detail-value" id="detailDuration">-</div>
                </div>

                <div class="task-detail-section full-width">
                    <div class="detail-label">Fayl Əlavələri</div>
                    <div class="modal-file-attachments" id="detailAttachments">
                        <div class="empty-attachments">
                            <i class="fas fa-paperclip"></i>
                            <span>Fayl əlavə edilməyib</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="secondary-btn" id="closeDetailsBtn">
                <i class="fas fa-times"></i>
                Bağla
            </button>
        </div>
    </div>
</div>

<div class="notifications-container" id="notificationsContainer"></div>
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="loader">
            <div></div>
            <div></div>
        </div>
        <p class="loading-text" id="loadingText">Yüklənir...</p>
    </div>
</div>

<script src="../assets/js/task_js/dashboardRedirect.js"></script>
<script src="../assets/js/task_js/soundManager.js"></script>
<script src="../assets/js/task_js/apiService.js"></script>
<script src="../assets/js/task_js/authService.js"></script>
<script src="../assets/js/task_js/cacheService.js"></script>
<script src="../assets/js/task_js/columnResizer.js"></script>
<script src="../assets/js/task_js/formatters.js"></script>
<script src="../assets/js/task_js/excelExport.js"></script>
<script src="../assets/js/task_js/buttonManager.js"></script>
<script src="../assets/js/task_js/validators.js"></script>
<script src="../assets/js/task_js/notification.js"></script>
<script src="../assets/js/task_js/formManager.js"></script>
<script src="../assets/js/task_js/audioRecorder.js"></script>
<script src="../assets/js/task_js/fileUpload.js"></script>
<script src="../assets/js/task_js/modalManager.js"></script>
<script src="../assets/js/task_js/tableManager.js"></script>
<script src="../assets/js/task_js/taskEditModul.js"></script>
<script src="../assets/js/task_js/websocketManager.js"></script>
<script src="../assets/js/task_js/partnerTask.js"></script>
<script src="../assets/js/task_js/task.js"></script>


<script>
    function switchTaskView(viewName, element) {
        const menuContainer = document.getElementById('mainTaskMenu');
        const header = document.getElementById('mainHeader');
        const contentArea = document.getElementById('mainContentArea');

        // YOXLA: Əgər kliklənən düymə artıq aktivdirsə (bağlamaq istəyir)
        if (element && element.classList.contains('active-tab')) {

            // 1. Navbar rejimini ləğv et (Aşağı düşür)
            menuContainer.classList.remove('nav-mode');

            // 2. Header və Məzmunu gizlət
            header.classList.remove('header-visible');
            contentArea.classList.remove('content-visible');

            // 3. Aktivlik klaslarını sil (Kartlar ilkin formasına qayıdır)
            element.classList.remove('active-tab');
            document.querySelectorAll('.task-section').forEach(sec => sec.classList.remove('active-section'));

            // Funksiyanı burada dayandır
            return;
        }

        // --- ƏGƏR YENİ BİR BÖLMƏ AÇILIRSA VƏ YA DƏYİŞDİRİLİRSƏ ---

        // 1. Menyunun "Navbar" rejiminə keçməsi (Yuxarı qalxır)
        menuContainer.classList.add('nav-mode');

        // 2. Header və Content-in görünməsi
        header.classList.add('header-visible');
        contentArea.classList.add('content-visible');

        // 3. Tabların aktivlik statusu
        // Bütün kartlardan 'active-tab' classını sil
        document.querySelectorAll('.menu-card').forEach(card => card.classList.remove('active-tab'));
        // Kliklənən karta 'active-tab' əlavə et
        if(element) {
            element.classList.add('active-tab');
        }

        // 4. Bölmələrin (Sections) dəyişdirilməsi
        // Hamısını gizlət
        document.querySelectorAll('.task-section').forEach(sec => sec.classList.remove('active-section'));

        // Lazım olanı göstər
        const targetSection = document.getElementById('section-' + viewName);
        if(targetSection) {
            targetSection.classList.add('active-section');
        }

        // 5. Xüsusi loqika (Partnyorlar üçün)
        if (viewName === 'partner') {
            if (window.PartnerTaskManager) {
                window.PartnerTaskManager.init();
            }
        }
    }

    // Səhifə yüklənəndə heç bir view aktiv deyil, menyu mərkəzdədir.
</script>
</body>
</html>